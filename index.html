<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (head content remains the same) ... -->
</head>
<body>
  <!-- ... (body content remains the same) ... -->

  <script src="https://js.arcgis.com/4.26/"></script>
  <script>
  document.addEventListener("DOMContentLoaded", function() {
    console.log("DOM fully loaded and parsed");
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/GeoJSONLayer",
      "esri/renderers/SimpleRenderer",
      "esri/symbols/SimpleMarkerSymbol",
      "esri/symbols/SimpleLineSymbol",
      "esri/symbols/PictureMarkerSymbol",
      "esri/geometry/Extent",
      "esri/layers/VectorTileLayer",
      "esri/request"
    ], function(Map, MapView, GeoJSONLayer, SimpleRenderer, SimpleMarkerSymbol, SimpleLineSymbol, PictureMarkerSymbol, Extent, VectorTileLayer, esriRequest) {
      console.log("Modules loaded");

      var map = new Map({
        basemap: "streets-vector"
      });
      console.log("Map created");

      var view = new MapView({
        container: "viewDiv",
        map: map,
        extent: new Extent({
          xmin: 165.0,
          ymin: -48.0,
          xmax: 179.5,
          ymax: -33.5,
          spatialReference: { wkid: 4326 }
        }),
        constraints: {
          minZoom: 4,
          maxZoom: 18,
          rotationEnabled: false,
          geometry: new Extent({
            xmin: 165.0,
            ymin: -48.0,
            xmax: 179.5,
            ymax: -33.5,
            spatialReference: { wkid: 4326 }
          })
        }
      });
      console.log("View created");

      // ... (rest of your code for loading GeoJSON layers remains the same) ...

      .then(() => {
        // Add line layers first
        lineLayers.forEach(layer => {
          map.add(layer);
          console.log(`Line layer ${layer.title} added to map`);
        });

        // Then add point layers
        pointLayers.forEach(layer => {
          map.add(layer);
          console.log(`Point layer ${layer.title} added to map`);
        });

        // Add label layer on top
        esriRequest("https://www.arcgis.com/sharing/rest/content/items/4cf7e1fb9f254dcda9c8fbadb15cf0f8/resources/styles/root.json", {
          responseType: "json"
        }).then(function(response) {
          var style = response.data;
          
          // Modify the style to show only labels
          style.layers = style.layers.filter(layer => layer.type === "symbol");
          
          var labelLayer = new VectorTileLayer({
            url: "https://basemaps.arcgis.com/arcgis/rest/services/World_Basemap_v2/VectorTileServer",
            style: style,
            opacity: 0.7
          });
          
          map.add(labelLayer);
          console.log("Label layer added to map");
        });
      }).catch(error => {
        console.error("Error loading layers:", error);
      });
    });
  });
  </script>
</body>
</html>
